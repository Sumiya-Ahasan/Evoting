{% extends "base.html" %}
{% block content %}
<h2 class="page-title mb-3">Live Results</h2>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card card-body">
      <h5>Bar Chart</h5>
      <canvas id="barChart"></canvas>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card card-body">
      <h5>Pie Chart</h5>
      <canvas id="pieChart"></canvas>
    </div>
  </div>
</div>

<div class="mt-3 subtle">Auto refresh every 3 seconds.</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let barChart, pieChart;

async function fetchData(){
  const res = await fetch("/elections/results-data/");
  return await res.json();
}

async function renderCharts(){
  const data = await fetchData();
  const labels = data.labels || [];
  const counts = data.counts || [];

  const barCtx = document.getElementById("barChart");
  const pieCtx = document.getElementById("pieChart");

  if (barChart) barChart.destroy();
  if (pieChart) pieChart.destroy();

  barChart = new Chart(barCtx, {
    type: "bar",
    data: { labels, datasets: [{ label: "Votes", data: counts }] },
  });

  pieChart = new Chart(pieCtx, {
    type: "pie",
    data: { labels, datasets: [{ label: "Votes", data: counts }] },
  });
}

renderCharts();
setInterval(renderCharts, 3000);
</script>
{% endblock %}
